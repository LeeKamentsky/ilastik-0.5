#!/bin/bash

if [ -z "$2" ]; then
	echo ' ' 
	echo "usage: $0" '<source-directory> <package-tag> [ <build-directory> [ <number-of-cpus> [ <memory-in-GB> [ <ssh-port> ] ] ] ]'
	echo ' ' 
	echo 'defaults: <build-directory> =' "/tmp/ilastik-build-$USER"
	echo '          <number-of-cpus> = number of host cores / 2;'
	echo '          <memory-in-GB> = 2 * <number-of-cpus>'
	echo '          <ssh-port> = 2222'
	exit 1
fi

if [ -z "$3" ]; then
	tmp_dir="/tmp/ilastik-build-$USER"
else
	tmp_dir="$3"
fi

qemu_master=/export/home/users/mip/ilastik/build/vm_masters/vm_fedora12_0.sparse.qcow2

# convert source-dir to absolute path:
src_dir=`readlink -m $1`  # requires GNU readlink.

echo building in $tmp_dir :
mkdir -p $tmp_dir
cd  $tmp_dir
export PATH=$PATH:/export/home/users/mip/ilastik/build/local/bin
qemu-img create -b $qemu_master -f qcow2 vm_fedora12_user.qcow2 >/dev/null
echo ilastik-build $src_dir $2 vm_fedora12_user.qcow2 $4 $5 $6
####/export/home/users/mip/ilastik/build/local/bin/ilastik-build $src_dir $2 vm_fedora12_user.qcow2 $4 $5 $6
/export/home/mnullmei/x/ilastik/bin/ilastik-build $src_dir $2 vm_fedora12_user.qcow2 $4 $5 $6
